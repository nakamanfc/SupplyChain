{"ast":null,"code":"'use strict';\n\nconst debug = require('debug');\n\nconst log = Object.assign(debug('libp2p:peer-store:proto-book'), {\n  error: debug('libp2p:peer-store:proto-book:err')\n});\n\nconst errcode = require('err-code');\n\nconst {\n  equals: uint8ArrayEquals\n} = require('uint8arrays/equals');\n\nconst PeerId = require('peer-id');\n\nconst Book = require('./book');\n\nconst {\n  codes: {\n    ERR_INVALID_PARAMETERS\n  }\n} = require('../errors');\n/**\n * @typedef {import('./')} PeerStore\n */\n\n/**\n * @extends {Book}\n *\n * @fires MetadataBook#change:metadata\n */\n\n\nclass MetadataBook extends Book {\n  /**\n   * The MetadataBook is responsible for keeping the known supported\n   * protocols of a peer.\n   *\n   * @class\n   * @param {PeerStore} peerStore\n   */\n  constructor(peerStore) {\n    /**\n     * PeerStore Event emitter, used by the MetadataBook to emit:\n     * \"change:metadata\" - emitted when the known metadata of a peer change.\n     */\n    super({\n      peerStore,\n      eventName: 'change:metadata',\n      eventProperty: 'metadata'\n    });\n    /**\n     * Map known peers to their known protocols.\n     *\n     * @type {Map<string, Map<string, Uint8Array>>}\n     */\n\n    this.data = new Map();\n  }\n  /**\n   * Set metadata key and value of a provided peer.\n   *\n   * @override\n   * @param {PeerId} peerId\n   * @param {string} key - metadata key\n   * @param {Uint8Array} value - metadata value\n   * @returns {MetadataBook}\n   */\n  // @ts-ignore override with more then the parameters expected in Book\n\n\n  set(peerId, key, value) {\n    if (!PeerId.isPeerId(peerId)) {\n      log.error('peerId must be an instance of peer-id to store data');\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS);\n    }\n\n    if (typeof key !== 'string' || !(value instanceof Uint8Array)) {\n      log.error('valid key and value must be provided to store data');\n      throw errcode(new Error('valid key and value must be provided'), ERR_INVALID_PARAMETERS);\n    }\n\n    this._setValue(peerId, key, value);\n\n    return this;\n  }\n  /**\n   * Set data into the datastructure\n   *\n   * @override\n   * @param {PeerId} peerId\n   * @param {string} key\n   * @param {Uint8Array} value\n   */\n\n\n  _setValue(peerId, key, value, {\n    emit = true\n  } = {}) {\n    const id = peerId.toB58String();\n    const rec = this.data.get(id) || new Map();\n    const recMap = rec.get(key); // Already exists and is equal\n\n    if (recMap && uint8ArrayEquals(value, recMap)) {\n      log(`the metadata provided to store is equal to the already stored for ${id} on ${key}`);\n      return;\n    }\n\n    rec.set(key, value);\n    this.data.set(id, rec);\n    emit && this._emit(peerId, key);\n  }\n  /**\n   * Get the known data of a provided peer.\n   *\n   * @param {PeerId} peerId\n   * @returns {Map<string, Uint8Array>|undefined}\n   */\n\n\n  get(peerId) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS);\n    }\n\n    return this.data.get(peerId.toB58String());\n  }\n  /**\n   * Get specific metadata value, if it exists\n   *\n   * @param {PeerId} peerId\n   * @param {string} key\n   * @returns {Uint8Array | undefined}\n   */\n\n\n  getValue(peerId, key) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS);\n    }\n\n    const rec = this.data.get(peerId.toB58String());\n    return rec && rec.get(key);\n  }\n  /**\n   * Deletes the provided peer from the book.\n   *\n   * @param {PeerId} peerId\n   * @returns {boolean}\n   */\n\n\n  delete(peerId) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS);\n    }\n\n    if (!this.data.delete(peerId.toB58String())) {\n      return false;\n    }\n\n    this._emit(peerId);\n\n    return true;\n  }\n  /**\n   * Deletes the provided peer metadata key from the book.\n   *\n   * @param {PeerId} peerId\n   * @param {string} key\n   * @returns {boolean}\n   */\n\n\n  deleteValue(peerId, key) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS);\n    }\n\n    const rec = this.data.get(peerId.toB58String());\n\n    if (!rec || !rec.delete(key)) {\n      return false;\n    }\n\n    this._emit(peerId, key);\n\n    return true;\n  }\n\n}\n\nmodule.exports = MetadataBook;","map":{"version":3,"sources":["C:/Users/user/mew-supplychain/front-end/node_modules/libp2p/src/peer-store/metadata-book.js"],"names":["debug","require","log","Object","assign","error","errcode","equals","uint8ArrayEquals","PeerId","Book","codes","ERR_INVALID_PARAMETERS","MetadataBook","constructor","peerStore","eventName","eventProperty","data","Map","set","peerId","key","value","isPeerId","Error","Uint8Array","_setValue","emit","id","toB58String","rec","get","recMap","_emit","getValue","delete","deleteValue","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst debug = require('debug')\nconst log = Object.assign(debug('libp2p:peer-store:proto-book'), {\n  error: debug('libp2p:peer-store:proto-book:err')\n})\nconst errcode = require('err-code')\nconst { equals: uint8ArrayEquals } = require('uint8arrays/equals')\n\nconst PeerId = require('peer-id')\n\nconst Book = require('./book')\n\nconst {\n  codes: { ERR_INVALID_PARAMETERS }\n} = require('../errors')\n\n/**\n * @typedef {import('./')} PeerStore\n */\n\n/**\n * @extends {Book}\n *\n * @fires MetadataBook#change:metadata\n */\nclass MetadataBook extends Book {\n  /**\n   * The MetadataBook is responsible for keeping the known supported\n   * protocols of a peer.\n   *\n   * @class\n   * @param {PeerStore} peerStore\n   */\n  constructor (peerStore) {\n    /**\n     * PeerStore Event emitter, used by the MetadataBook to emit:\n     * \"change:metadata\" - emitted when the known metadata of a peer change.\n     */\n    super({\n      peerStore,\n      eventName: 'change:metadata',\n      eventProperty: 'metadata'\n    })\n\n    /**\n     * Map known peers to their known protocols.\n     *\n     * @type {Map<string, Map<string, Uint8Array>>}\n     */\n    this.data = new Map()\n  }\n\n  /**\n   * Set metadata key and value of a provided peer.\n   *\n   * @override\n   * @param {PeerId} peerId\n   * @param {string} key - metadata key\n   * @param {Uint8Array} value - metadata value\n   * @returns {MetadataBook}\n   */\n  // @ts-ignore override with more then the parameters expected in Book\n  set (peerId, key, value) {\n    if (!PeerId.isPeerId(peerId)) {\n      log.error('peerId must be an instance of peer-id to store data')\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS)\n    }\n\n    if (typeof key !== 'string' || !(value instanceof Uint8Array)) {\n      log.error('valid key and value must be provided to store data')\n      throw errcode(new Error('valid key and value must be provided'), ERR_INVALID_PARAMETERS)\n    }\n\n    this._setValue(peerId, key, value)\n\n    return this\n  }\n\n  /**\n   * Set data into the datastructure\n   *\n   * @override\n   * @param {PeerId} peerId\n   * @param {string} key\n   * @param {Uint8Array} value\n   */\n  _setValue (peerId, key, value, { emit = true } = {}) {\n    const id = peerId.toB58String()\n    const rec = this.data.get(id) || new Map()\n    const recMap = rec.get(key)\n\n    // Already exists and is equal\n    if (recMap && uint8ArrayEquals(value, recMap)) {\n      log(`the metadata provided to store is equal to the already stored for ${id} on ${key}`)\n      return\n    }\n\n    rec.set(key, value)\n    this.data.set(id, rec)\n\n    emit && this._emit(peerId, key)\n  }\n\n  /**\n   * Get the known data of a provided peer.\n   *\n   * @param {PeerId} peerId\n   * @returns {Map<string, Uint8Array>|undefined}\n   */\n  get (peerId) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS)\n    }\n\n    return this.data.get(peerId.toB58String())\n  }\n\n  /**\n   * Get specific metadata value, if it exists\n   *\n   * @param {PeerId} peerId\n   * @param {string} key\n   * @returns {Uint8Array | undefined}\n   */\n  getValue (peerId, key) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS)\n    }\n\n    const rec = this.data.get(peerId.toB58String())\n    return rec && rec.get(key)\n  }\n\n  /**\n   * Deletes the provided peer from the book.\n   *\n   * @param {PeerId} peerId\n   * @returns {boolean}\n   */\n  delete (peerId) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS)\n    }\n\n    if (!this.data.delete(peerId.toB58String())) {\n      return false\n    }\n\n    this._emit(peerId)\n\n    return true\n  }\n\n  /**\n   * Deletes the provided peer metadata key from the book.\n   *\n   * @param {PeerId} peerId\n   * @param {string} key\n   * @returns {boolean}\n   */\n  deleteValue (peerId, key) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS)\n    }\n\n    const rec = this.data.get(peerId.toB58String())\n\n    if (!rec || !rec.delete(key)) {\n      return false\n    }\n\n    this._emit(peerId, key)\n\n    return true\n  }\n}\n\nmodule.exports = MetadataBook\n"]},"metadata":{},"sourceType":"script"}