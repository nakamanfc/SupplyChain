{"ast":null,"code":"'use strict';\n\nconst Entry = require('./entry');\n\nconst {\n  base58btc\n} = require('multiformats/bases/base58');\n/**\n * @template T\n * @param {(v:T) => number} fn\n * @param {T[]} list\n * @returns {T[]}\n */\n\n\nconst sortBy = (fn, list) => {\n  return Array.prototype.slice.call(list, 0).sort((a, b) => {\n    const aa = fn(a);\n    const bb = fn(b);\n    return aa < bb ? -1 : aa > bb ? 1 : 0;\n  });\n};\n/**\n * @typedef {import('multiformats').CID} CID\n */\n\n\nclass Wantlist {\n  /**\n   *\n   * @param {import('../../stats')} [stats]\n   */\n  constructor(stats) {\n    /** @type {Map<string, Entry>} */\n    this.set = new Map();\n    this._stats = stats;\n  }\n\n  get length() {\n    return this.set.size;\n  }\n  /**\n   * @param {CID} cid\n   * @param {number} priority\n   * @param {import('../message/message').Message.Wantlist.WantType} wantType\n   */\n\n\n  add(cid, priority, wantType) {\n    // Have to import here to avoid circular reference\n    const Message = require('../message');\n\n    const cidStr = cid.toString(base58btc);\n    const entry = this.set.get(cidStr);\n\n    if (entry) {\n      entry.inc();\n      entry.priority = priority; // We can only overwrite want-have with want-block\n\n      if (entry.wantType === Message.WantType.Have && wantType === Message.WantType.Block) {\n        entry.wantType = wantType;\n      }\n    } else {\n      this.set.set(cidStr, new Entry(cid, priority, wantType));\n\n      if (this._stats) {\n        this._stats.push(null, 'wantListSize', 1);\n      }\n    }\n  }\n  /**\n   * @param {CID} cid\n   */\n\n\n  remove(cid) {\n    const cidStr = cid.toString(base58btc);\n    const entry = this.set.get(cidStr);\n\n    if (!entry) {\n      return;\n    }\n\n    entry.dec(); // only delete when no refs are held\n\n    if (entry.hasRefs()) {\n      return;\n    }\n\n    this.set.delete(cidStr);\n\n    if (this._stats) {\n      this._stats.push(null, 'wantListSize', -1);\n    }\n  }\n  /**\n   * @param {string} cidStr\n   */\n\n\n  removeForce(cidStr) {\n    if (this.set.has(cidStr)) {\n      this.set.delete(cidStr);\n    }\n  }\n  /**\n   * @param {(entry:Entry, key:string) => void} fn\n   */\n\n\n  forEach(fn) {\n    return this.set.forEach(fn);\n  }\n\n  entries() {\n    return this.set.entries();\n  }\n\n  sortedEntries() {\n    // TODO: Figure out if this is an actual bug.\n    // @ts-expect-error - Property 'key' does not exist on type 'WantListEntry'\n    return new Map(sortBy(o => o[1].key, Array.from(this.set.entries())));\n  }\n  /**\n   * @param {CID} cid\n   */\n\n\n  contains(cid) {\n    const cidStr = cid.toString(base58btc);\n    return this.set.has(cidStr);\n  }\n  /**\n   * @param {CID} cid\n   */\n\n\n  get(cid) {\n    const cidStr = cid.toString(base58btc);\n    return this.set.get(cidStr);\n  }\n\n}\n\nWantlist.Entry = Entry;\nmodule.exports = Wantlist;","map":{"version":3,"sources":["C:/Users/user/mew-supplychain/front-end/node_modules/ipfs-bitswap/src/types/wantlist/index.js"],"names":["Entry","require","base58btc","sortBy","fn","list","Array","prototype","slice","call","sort","a","b","aa","bb","Wantlist","constructor","stats","set","Map","_stats","length","size","add","cid","priority","wantType","Message","cidStr","toString","entry","get","inc","WantType","Have","Block","push","remove","dec","hasRefs","delete","removeForce","has","forEach","entries","sortedEntries","o","key","from","contains","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAgBD,OAAO,CAAC,2BAAD,CAA7B;AAEA;AACA;AACA;AACA;AACA;AACA;;;AACA,MAAME,MAAM,GAAG,CAACC,EAAD,EAAKC,IAAL,KAAc;AAC3B,SAAOC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BJ,IAA3B,EAAiC,CAAjC,EAAoCK,IAApC,CAAyC,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACxD,UAAMC,EAAE,GAAGT,EAAE,CAACO,CAAD,CAAb;AACA,UAAMG,EAAE,GAAGV,EAAE,CAACQ,CAAD,CAAb;AACA,WAAOC,EAAE,GAAGC,EAAL,GAAU,CAAC,CAAX,GAAeD,EAAE,GAAGC,EAAL,GAAU,CAAV,GAAc,CAApC;AACD,GAJM,CAAP;AAKD,CAND;AAQA;AACA;AACA;;;AAEA,MAAMC,QAAN,CAAe;AACb;AACF;AACA;AACA;AACEC,EAAAA,WAAW,CAAEC,KAAF,EAAS;AAClB;AACA,SAAKC,GAAL,GAAW,IAAIC,GAAJ,EAAX;AACA,SAAKC,MAAL,GAAcH,KAAd;AACD;;AAES,MAANI,MAAM,GAAI;AACZ,WAAO,KAAKH,GAAL,CAASI,IAAhB;AACD;AAED;AACF;AACA;AACA;AACA;;;AACEC,EAAAA,GAAG,CAAEC,GAAF,EAAOC,QAAP,EAAiBC,QAAjB,EAA2B;AAC5B;AACA,UAAMC,OAAO,GAAG1B,OAAO,CAAC,YAAD,CAAvB;;AAEA,UAAM2B,MAAM,GAAGJ,GAAG,CAACK,QAAJ,CAAa3B,SAAb,CAAf;AACA,UAAM4B,KAAK,GAAG,KAAKZ,GAAL,CAASa,GAAT,CAAaH,MAAb,CAAd;;AAEA,QAAIE,KAAJ,EAAW;AACTA,MAAAA,KAAK,CAACE,GAAN;AACAF,MAAAA,KAAK,CAACL,QAAN,GAAiBA,QAAjB,CAFS,CAIT;;AACA,UAAIK,KAAK,CAACJ,QAAN,KAAmBC,OAAO,CAACM,QAAR,CAAiBC,IAApC,IAA4CR,QAAQ,KAAKC,OAAO,CAACM,QAAR,CAAiBE,KAA9E,EAAqF;AACnFL,QAAAA,KAAK,CAACJ,QAAN,GAAiBA,QAAjB;AACD;AACF,KARD,MAQO;AACL,WAAKR,GAAL,CAASA,GAAT,CAAaU,MAAb,EAAqB,IAAI5B,KAAJ,CAAUwB,GAAV,EAAeC,QAAf,EAAyBC,QAAzB,CAArB;;AACA,UAAI,KAAKN,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYgB,IAAZ,CAAiB,IAAjB,EAAuB,cAAvB,EAAuC,CAAvC;AACD;AACF;AACF;AAED;AACF;AACA;;;AACEC,EAAAA,MAAM,CAAEb,GAAF,EAAO;AACX,UAAMI,MAAM,GAAGJ,GAAG,CAACK,QAAJ,CAAa3B,SAAb,CAAf;AACA,UAAM4B,KAAK,GAAG,KAAKZ,GAAL,CAASa,GAAT,CAAaH,MAAb,CAAd;;AAEA,QAAI,CAACE,KAAL,EAAY;AACV;AACD;;AAEDA,IAAAA,KAAK,CAACQ,GAAN,GARW,CAUX;;AACA,QAAIR,KAAK,CAACS,OAAN,EAAJ,EAAqB;AACnB;AACD;;AAED,SAAKrB,GAAL,CAASsB,MAAT,CAAgBZ,MAAhB;;AACA,QAAI,KAAKR,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYgB,IAAZ,CAAiB,IAAjB,EAAuB,cAAvB,EAAuC,CAAC,CAAxC;AACD;AACF;AAED;AACF;AACA;;;AACEK,EAAAA,WAAW,CAAEb,MAAF,EAAU;AACnB,QAAI,KAAKV,GAAL,CAASwB,GAAT,CAAad,MAAb,CAAJ,EAA0B;AACxB,WAAKV,GAAL,CAASsB,MAAT,CAAgBZ,MAAhB;AACD;AACF;AAED;AACF;AACA;;;AACEe,EAAAA,OAAO,CAAEvC,EAAF,EAAM;AACX,WAAO,KAAKc,GAAL,CAASyB,OAAT,CAAiBvC,EAAjB,CAAP;AACD;;AAEDwC,EAAAA,OAAO,GAAI;AACT,WAAO,KAAK1B,GAAL,CAAS0B,OAAT,EAAP;AACD;;AAEDC,EAAAA,aAAa,GAAI;AACf;AACA;AACA,WAAO,IAAI1B,GAAJ,CAAQhB,MAAM,CAAC2C,CAAC,IAAIA,CAAC,CAAC,CAAD,CAAD,CAAKC,GAAX,EAAgBzC,KAAK,CAAC0C,IAAN,CAAW,KAAK9B,GAAL,CAAS0B,OAAT,EAAX,CAAhB,CAAd,CAAP;AACD;AAED;AACF;AACA;;;AACEK,EAAAA,QAAQ,CAAEzB,GAAF,EAAO;AACb,UAAMI,MAAM,GAAGJ,GAAG,CAACK,QAAJ,CAAa3B,SAAb,CAAf;AACA,WAAO,KAAKgB,GAAL,CAASwB,GAAT,CAAad,MAAb,CAAP;AACD;AAED;AACF;AACA;;;AACEG,EAAAA,GAAG,CAAEP,GAAF,EAAO;AACR,UAAMI,MAAM,GAAGJ,GAAG,CAACK,QAAJ,CAAa3B,SAAb,CAAf;AACA,WAAO,KAAKgB,GAAL,CAASa,GAAT,CAAaH,MAAb,CAAP;AACD;;AA3GY;;AA8Gfb,QAAQ,CAACf,KAAT,GAAiBA,KAAjB;AACAkD,MAAM,CAACC,OAAP,GAAiBpC,QAAjB","sourcesContent":["'use strict'\n\nconst Entry = require('./entry')\nconst { base58btc } = require('multiformats/bases/base58')\n\n/**\n * @template T\n * @param {(v:T) => number} fn\n * @param {T[]} list\n * @returns {T[]}\n */\nconst sortBy = (fn, list) => {\n  return Array.prototype.slice.call(list, 0).sort((a, b) => {\n    const aa = fn(a)\n    const bb = fn(b)\n    return aa < bb ? -1 : aa > bb ? 1 : 0\n  })\n}\n\n/**\n * @typedef {import('multiformats').CID} CID\n */\n\nclass Wantlist {\n  /**\n   *\n   * @param {import('../../stats')} [stats]\n   */\n  constructor (stats) {\n    /** @type {Map<string, Entry>} */\n    this.set = new Map()\n    this._stats = stats\n  }\n\n  get length () {\n    return this.set.size\n  }\n\n  /**\n   * @param {CID} cid\n   * @param {number} priority\n   * @param {import('../message/message').Message.Wantlist.WantType} wantType\n   */\n  add (cid, priority, wantType) {\n    // Have to import here to avoid circular reference\n    const Message = require('../message')\n\n    const cidStr = cid.toString(base58btc)\n    const entry = this.set.get(cidStr)\n\n    if (entry) {\n      entry.inc()\n      entry.priority = priority\n\n      // We can only overwrite want-have with want-block\n      if (entry.wantType === Message.WantType.Have && wantType === Message.WantType.Block) {\n        entry.wantType = wantType\n      }\n    } else {\n      this.set.set(cidStr, new Entry(cid, priority, wantType))\n      if (this._stats) {\n        this._stats.push(null, 'wantListSize', 1)\n      }\n    }\n  }\n\n  /**\n   * @param {CID} cid\n   */\n  remove (cid) {\n    const cidStr = cid.toString(base58btc)\n    const entry = this.set.get(cidStr)\n\n    if (!entry) {\n      return\n    }\n\n    entry.dec()\n\n    // only delete when no refs are held\n    if (entry.hasRefs()) {\n      return\n    }\n\n    this.set.delete(cidStr)\n    if (this._stats) {\n      this._stats.push(null, 'wantListSize', -1)\n    }\n  }\n\n  /**\n   * @param {string} cidStr\n   */\n  removeForce (cidStr) {\n    if (this.set.has(cidStr)) {\n      this.set.delete(cidStr)\n    }\n  }\n\n  /**\n   * @param {(entry:Entry, key:string) => void} fn\n   */\n  forEach (fn) {\n    return this.set.forEach(fn)\n  }\n\n  entries () {\n    return this.set.entries()\n  }\n\n  sortedEntries () {\n    // TODO: Figure out if this is an actual bug.\n    // @ts-expect-error - Property 'key' does not exist on type 'WantListEntry'\n    return new Map(sortBy(o => o[1].key, Array.from(this.set.entries())))\n  }\n\n  /**\n   * @param {CID} cid\n   */\n  contains (cid) {\n    const cidStr = cid.toString(base58btc)\n    return this.set.has(cidStr)\n  }\n\n  /**\n   * @param {CID} cid\n   */\n  get (cid) {\n    const cidStr = cid.toString(base58btc)\n    return this.set.get(cidStr)\n  }\n}\n\nWantlist.Entry = Entry\nmodule.exports = Wantlist\n"]},"metadata":{},"sourceType":"script"}